<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fitness Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* Global Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 30px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      text-align: center;
    }

    h1 {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 20px;
    }

    input, select, button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      background: rgba(255, 255, 255, 0.2);
      color: #fff;
      outline: none;
      transition: background 0.3s ease;
    }

    input::placeholder, select {
      color: #ddd;
    }

    input:focus, select:focus {
      background: rgba(255, 255, 255, 0.3);
    }

    button {
      background: #667eea;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    button:hover {
      background: #5a6fd1;
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 30px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      animation: fadeIn 0.5s ease;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-header h2 {
      font-size: 24px;
      font-weight: 600;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 24px;
      color: #fff;
      cursor: pointer;
    }

    .modal-body {
      text-align: left;
    }

    .modal-body p {
      font-size: 14px;
      margin: 5px 0;
    }

    .modal-body h3 {
      font-size: 16px;
      margin-top: 15px;
      margin-bottom: 10px;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Responsive Design */
    @media (max-width: 480px) {
      h1 {
        font-size: 20px;
      }

      input, select, button {
        font-size: 14px;
      }

      .modal-content {
        padding: 20px;
      }

      .modal-header h2 {
        font-size: 20px;
      }

      .modal-body p {
        font-size: 12px;
      }

      .modal-body h3 {
        font-size: 14px;
      }
    }

    /* Additional Styles */
    .error-message {
      color: #ff6b6b;
      background: rgba(255, 107, 107, 0.1);
      padding: 10px;
      border-radius: 8px;
      margin: 10px 0;
      display: none;
    }

    .loading {
      display: none;
      margin: 10px 0;
    }

    .loading::after {
      content: '';
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #fff;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Fitness Tracker</h1>
    <div id="error-message" class="error-message"></div>
    <input type="text" id="name" placeholder="Enter Name">
    <input type="number" id="id" placeholder="Enter ID">
    <select id="day">
      <option value="">Select Day</option>
      <option value="Monday">Monday</option>
      <option value="Tuesday">Tuesday</option>
      <option value="Wednesday">Wednesday</option>
      <option value="Thursday">Thursday</option>
      <option value="Friday">Friday</option>
      <option value="Saturday">Saturday</option>
      <option value="Sunday">Sunday</option>
    </select>
    <div id="loading" class="loading"></div>
    <button onclick="fetchData()">Submit</button>
  </div>

  <!-- Modal Popup -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-title"></h2>
        <button class="close-btn" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-body" id="modal-body"></div>
    </div>
  </div>

  <script>
    // Function to show error message
    function showError(message) {
      const errorDiv = document.getElementById("error-message");
      errorDiv.textContent = message;
      errorDiv.style.display = "block";
      setTimeout(() => {
        errorDiv.style.display = "none";
      }, 5000);
    }

    // Function to toggle loading state
    function toggleLoading(show) {
      const loading = document.getElementById("loading");
      const submitButton = document.querySelector("button");
      loading.style.display = show ? "block" : "none";
      submitButton.disabled = show;
    }

    // Function to close modal
    function closeModal() {
      document.getElementById("modal").style.display = "none";
    }

    // Function to check server health
    async function checkServerHealth() {
      try {
        const response = await fetch('http://localhost:5001/health');
        const data = await response.json();
        return data.status === 'ok' && data.mongodb;
      } catch (error) {
        return false;
      }
    }

    // Function to fetch data and display in modal
    async function fetchData() {
      const name = document.getElementById("name").value.trim();
      const day = document.getElementById("day").value;
      const modal = document.getElementById("modal");
      const modalTitle = document.getElementById("modal-title");
      const modalBody = document.getElementById("modal-body");

      // Input validation
      if (!name) {
        showError("Please enter your name");
        return;
      }
      if (!day) {
        showError("Please select a day");
        return;
      }

      toggleLoading(true);

      try {
        // Check server health first
        const isServerHealthy = await checkServerHealth();
        if (!isServerHealthy) {
          throw new Error("Server or database is not available");
        }

        const response = await fetch(`http://localhost:5001/fitness-data?name=${encodeURIComponent(name)}&day=${encodeURIComponent(day)}`);
        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.message || 'Failed to fetch fitness data');
        }

        modalTitle.textContent = `${name}'s Fitness Data (${day})`;
        modalBody.innerHTML = `
          <p><strong>Steps:</strong> ${data.steps || 'N/A'}</p>
          <p><strong>Calories Burned:</strong> ${data.caloriesBurned || 'N/A'}</p>
          <p><strong>Heart Rate:</strong> ${data.heartRate || 'N/A'} bpm</p>
          <p><strong>Active Minutes:</strong> ${data.activeMinutes || 'N/A'}</p>
          ${data.sleep ? `
          <h3>Sleep</h3>
          <p><strong>Total Sleep:</strong> ${data.sleep.totalSleep || 'N/A'}</p>
          <p><strong>Deep Sleep:</strong> ${data.sleep.deepSleep || 'N/A'}</p>
          <p><strong>REM Sleep:</strong> ${data.sleep.remSleep || 'N/A'}</p>
          <p><strong>Sleep Score:</strong> ${data.sleep.sleepScore || 'N/A'}</p>
          ` : ''}
          ${data.workout ? `
          <h3>Workout</h3>
          <p><strong>Type:</strong> ${data.workout.type || 'N/A'}</p>
          <p><strong>Duration:</strong> ${data.workout.duration || 'N/A'}</p>
          <p><strong>Distance:</strong> ${data.workout.distance || 'N/A'}</p>
          <p><strong>Calories Burned:</strong> ${data.workout.caloriesBurned || 'N/A'}</p>
          ` : ''}
          ${data.health ? `
          <h3>Health</h3>
          <p><strong>BMI:</strong> ${data.health.bmi || 'N/A'}</p>
          <p><strong>Body Fat:</strong> ${data.health.bodyFat || 'N/A'}%</p>
          <p><strong>Hydration:</strong> ${data.health.hydration || 'N/A'}%</p>
          ` : ''}
        `;
        modal.style.display = "flex";
      } catch (error) {
        showError(error.message);
      } finally {
        toggleLoading(false);
      }
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
      const modal = document.getElementById("modal");
      if (event.target === modal) {
        closeModal();
      }
    }

    // Close modal with Escape key
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        closeModal();
      }
    });
  </script>
</body>
</html>